(function(t,e){function i(t){this.id=t,this.status=0,this.dependencies=[],this.exports=null,this.parent=[],this.factory=l}function n(t,e){i.use(y,function(n){R.addNameSpace(n),R.buildNameSpace(n,function(){var s=o._main;s.alias=n.alias,s.timestamp=n.timestamp,n.basepath&&(s.basepath=n.basepath),w&&R.isFunction(n.debugswitch)&&(t=n.debugswitch(t)||t),i.use(t,e)})})}var s=!(typeof window===e||!t.navigator||!t.document);if(s){var r,a,o={},c=t.document,l=(t.location,function(){}),h=Array.prototype,u=Object,f="utf-8",d=u.prototype.toString,p=c.head||c.getElementsByTagName("head")[0]||c.documentElement,g=(navigator.userAgent,c.getElementsByTagName("script")),v=g[g.length-1],m=function(t,e){return t.getAttribute(e)},_=m(v,"data-path")||v.src||m(v,"src"),y=m(v,"data-config"),w="true"===m(v,"data-debug"),x=m(v,"data-main"),b=p.getElementsByTagName("base")[0],T=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,S=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,C={},E={},I={},N=[],O=[],P=[],A={},k=function(t,e){if(1===arguments.length)return t;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},R=k({isString:function(t){return"[object String]"===d.call(t)},isFunction:function(t){return"[object Function]"===d.call(t)},isObject:function(t){return t===u(t)},forEach:h.forEach?function(t,e){t.forEach(e)}:function(t,e){for(var i=0;t.length>i;i++)e(t[i],i,t)},filter:h.filter?function(t,e){return t.filter(e)}:function(t,e){var i=[];return R.forEach(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i},map:h.map?function(t,e){return t.map(e)}:function(t,e){var i=[];return R.forEach(t,function(t,n,s){i.push(e(t,n,s))}),i},keys:u.keys?u.keys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},indexOf:h.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var i=0;t.length>i;i++)if(t[i]===e)return i;return-1},unique:function(t){var e={};return R.forEach(t,function(t){e[t]=1}),R.keys(e)},_createNode:function(t,e){var i=c.createElement(t);return e&&(i.charset=e),i},_insertScript:function(t){b?p.insertBefore(t,b):p.appendChild(t)},getScript:function(t,i,n){var s=R._createNode("script",n);s.onload=s.onerror=s.onreadystatechange=function(){/loaded|complete|undefined/.test(s.readyState)&&(s.onload=s.onerror=s.onreadystatechange=null,s.parentNode&&!w&&s.parentNode.removeChild(s),s=e,R.isFunction(i)&&i())},s.async="async",s.src=t,r=s,R._insertScript(s),r=null},_fetch:function(t,e){return I[t]?(e(),void 0):C[t]?(E[t].push(e),void 0):(C[t]=!0,E[t]=[e],R.getScript(t,function(){I[t]=!0,delete C[t];var e=E[t];e&&(delete E[t],R.forEach(e,function(t){t()}))},f),void 0)},getDependencies:function(t){var e=[];return t.replace(T,"").replace(S,function(t,i){e.push(i)}),R.unique(e)},fixNameSpace:function(t,e){var i=R.findPathNameSpace(t);return R.map(e,function(t){var e=R.getNameSpace(t);return i!=e&&"_main"==e?i+":"+t:t})},findPathNameSpace:function(t){for(var e in o)if(RegExp("^"+o[e].basepath).test(t))return e;return"_main"},getPureDependencies:function(t){var e=t.id;t.dependencies=R.fixNameSpace(e,t.dependencies);var n=R.filter(t.dependencies,function(t){N.push(e);var n=R.isCircularWaiting(i.cache[t]);return n&&N.push(e),N.pop(),!n});return R.createUrl(n)},isCircularWaiting:function(t){if(!t||t.status!==i.status.save)return!1;N.push(t.uri);var e=t.dependencies;if(e.length){if(R.isOverlap(e,N))return!0;for(var n=0;e.length>n;n++)if(R.isCircularWaiting(i.cache[e[n]]))return!0}return N.pop(),!1},isOverlap:function(t,e){var i=t.concat(e);return i.length>R.unique(i).length},runModuleContext:function(t,i){var n;try{n=t(i.require,i.exports,i)}catch(s){throw i.id+":"+s}n!==e&&(i.exports=n)},dirname:function(t){var e=t.match(/[^?]*(?=\/.*$)/);return(e?e[0]:".")+"/"},realpath:function(t){var e=/([^:\/])\/\/+/g;if(e.lastIndex=0,e.test(t)&&(t=t.replace(e,"$1/")),-1===t.indexOf("."))return t;for(var i,n=t.split("/"),s=[],r=0;n.length>r;r++)if(i=n[r],".."===i){if(0===s.length)throw Error("The path is invalid: "+t);s.pop()}else"."!==i&&s.push(i);return s.join("/")},normalize:function(t){t=R.realpath(t);var e=t.charAt(t.length-1);return"/"===e?t:("#"===e?t=t.slice(0,-1):-1!==t.indexOf("?")||/\.(?:js)$/.test(t)||(t+=".js"),t.indexOf(":80/")>0&&(t=t.replace(":80/","/")),t)},resolve:function(t,e){var i="";return t?(0===t.indexOf("./")||0===t.indexOf("../")?(0===t.indexOf("./")&&(t=t.substring(2)),i=R.dirname(e)+t):i="/"===t.charAt(0)&&"/"!==t.charAt(1)?R.dirname(e)+t.substring(1):R.dirname(e)+"/"+t,R.normalize(i)):i},isAbsolute:function(t){return t.indexOf("://")>0||0===t.indexOf("//")},filename:function(t){return t.slice(t.lastIndexOf("/")+1).replace(/\?.*$/,"")},getNameSpace:function(t){if(R.isAbsolute(t))return"_main";var e=t.split(":");return e[1]?e[0]:"_main"},replaceDir:function(t,e){for(var i={},n=0;e.length>n;n++){var s=e[n];for(var r in s){var a=s[r],o=RegExp("^"+r+"/");if(o.test(t)&&!i[t]){t=t.replace(o,a),i[t]=!0;break}}if(i[t])break}return R.isAbsolute(t)&&(t=R.normalize(t)),t},isDir:function(t){return t.lastIndexOf("/")===t.length-1},getAliasDir:function(t){var e=[];for(var i in t)if(R.isDir(t[i])){var n={};n[i]=t[i],e.push(n)}return e},createUrl:function(t){return R.map(t,function(t){var e=R.getNameSpace(t);"_main"!==e&&(t=t.split(":")[1]),o.hasOwnProperty(t)&&(e=t);var i=o[e];if(i){var n=R.getAliasDir(i.alias);if(i.alias){var s=i.alias[t];s&&!R.isDir(s)?t=s:n.length&&(t=R.replaceDir(t,n))}return R.isAbsolute(t)||(t=R.resolve(t,i.basepath)),i.timestamp&&(t=t+"?"+i.timestamp),t}throw Error("the namespace "+e+" is not found!")})},buildNameSpace:function(t,e){R.addConfigs(t,function(t){R.forEach(t,function(t){var e=o[t.name];e.alias=t.alias,e.timestamp=t.timestamp}),e&&e()})},_hasClear:function(t,e){return delete t[e],R.keys(t).length?!1:!0},addConfigs:function(t,e,n){var s=n||R.keys(o).length;if(1===R.keys(o).length)return t.name="_main",e([t]),void 0;for(var r in o){var a=o[r].config;"_main"!==r&&(A[r]||function(t,n){A[n]=!0,i.use(n+":"+t,function(t){t.name=n,P.push(t),R.addNameSpace(t);var i=R.keys(o).length;i>s&&R.addConfigs(t,e,i);var r=R._hasClear(A,n);r&&e(P)})}(a,r))}},addNameSpace:function(t){if(t.hasOwnProperty("namespace"))for(var e in t.namespace){var i=t.namespace[e];o[e]={basepath:i.basepath,config:i.config}}},getCurrentScript:function(){if(r)return r;if(a&&"interactive"===a.readyState)return a;for(var t=p.getElementsByTagName("script"),e=t.length-1;e>=0;e--){var i=t[e];if("interactive"===i.readyState)return a=i}return a},pathToid:function(t,e){var i=R.findPathNameSpace(t);e=e||R.filename(t);var n="_main"===i?e:i+":"+e;return R.createUrl([n])[0]},_save:function(t){R.forEach(O,function(e){if(!e.id)throw Error("more than ones anonymouse define in one file!");e.id=R.pathToid(t,e.id),i._save(e.id,e)})}});o._main={basepath:R.dirname(_),config:y},k(i,{cache:{},status:{created:0,save:1,ready:2,compiling:3,compiled:4},_get:function(t){return i.cache[t]||(i.cache[t]=new i(t))},_save:function(t,e){var n=this._get(t);n.status<i.status.save&&(n.id=t||e.id,n.dependencies=e.deps,n.factory=e.factory,n.status=i.status.save)},define:function(t,n){if(R.isFunction(t)&&(n=t,t=e),!R.isFunction(n))throw"define failed";var s=R.getDependencies(""+n),r={deps:s,factory:n};if(t&&R.isAbsolute(t)&&(r.id=t),!r.id&&c.attachEvent){var a=R.getCurrentScript();if(!a)throw Error('failed to derive:" '+n);r.id=R.pathToid(a.src)}r.id?i._save(r.id,r):(r.id=t,O.push(r))},_createUrls:function(t){R.isString(t)&&(t=[t]);var e=R.createUrl(t);return e},use:function(t,e){var n=i._createUrls(t);i._fetch(n,function(){var t=R.map(n,function(t){return t?i.cache[t]._compile():null});R.isFunction(e)&&e.apply(null,t)})},_preload:function(t,e){var n=i._createUrls(t)[0];R._fetch(n,function(){var t=O.length;t&&(t>1?R._save(n):i._save(n,O[0]),O=[]),e()})},_fetch:function(t,e){var n=i.status,s=R.filter(t,function(t){return t&&(!i.cache[t]||i.cache[t].status<n.ready)}),r=function(t){(t||{}).status<n.ready&&(t.status=n.ready),--o,0===o&&e()},a=s.length;if(0===a)return e(),void 0;for(var o=a,c=0;a>c;c++)(function(t){function e(){var e=O.length;if(e&&(e>1?R._save(t):i._save(t,O[0]),O=[]),s=i._get(t),s.status>=n.save){var a=R.getPureDependencies(s);a.length?i._fetch(a,function(){r(s)}):r(s)}else r()}var s=i._get(t);s.status<i.status.save?R._fetch(t,e):e()})(s[c])}}),k(i.prototype,{_compile:function(){function require(n){for(var s in t.dependencies){var r=t.dependencies[s],a=R.getNameSpace(r);"_main"!=a&&n==r.split(":")[1]&&(n=a+":"+n)}n=R.createUrl([n]);var o=i.cache[n];return o?o.status===e.compiled?o.exports:(o.parent=t,o._compile()):null}var t=this,e=i.status;if(t.status===e.compiled)return t.exports;if(t.status<e.save)return null;t.status=e.compiling,require.cache=i.cache,t.require=require,t.exports={};var n=t.factory;return R.isFunction(n)&&R.runModuleContext(n,t),t.status=e.compiled,t.exports}}),t.define=i.define,t.lithe=k({use:i.use,cache:i.cache,NAMESPACE:o,start:function(t,e){y?w?n(t,e):i._preload(t,function(){n(t,e)}):i.use(t,e)}}),x&&t.lithe.start(x)}else exports.tool=require("./lib/lithe-tool.js"),exports.hfs=require("./lib/lithe-hfs.js")})(this);