/* 
 lithe 
 @author xiaojue [designsor@gmail.com] 
 @fileoverview a javascript common loader 
 @vserion 0.1.9 
 */
(function(t,n){function e(t,n){return n=n||C,n?n.getElementsByTagName(t):n}function r(){}function i(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function a(t){return"[object String]"===T.call(t)}function o(t){return"[object Function]"===T.call(t)}function u(t){var n={};return z(t,function(t){n[t]=1}),H(n)}function c(t,n){return t.getAttribute(n)}function s(t){var n=[];return t.replace(F,"").replace(R,function(t,e){n.push(e)}),u(n)}function f(t,e){var r;try{r=t(e.require,e.exports,e)}catch(i){throw Error(e.id+":"+i)}r!==n&&(e.exports=r)}function h(){this.map={}}function p(t){return!d(t)}function l(t){var n=t.match(/[^?]*(?=\/.*$)/);return(n?n[0]:".")+"/"}function d(t){return t.slice(t.lastIndexOf("/")+1).replace(/\?.*$/,"")}function v(t){var n=/([^:\/])\/\/+/g;if(n.lastIndex=0,n.test(t)&&(t=t.replace(n,"$1/")),-1===t.indexOf("."))return t;for(var e,r=t.split("/"),i=[],a=0;r.length>a;a++)if(e=r[a],".."===e){if(0===i.length)throw Error("The path is invalid: "+t);i.pop()}else"."!==e&&i.push(e);return i.join("/")}function g(t){t=v(t);var n=t.charAt(t.length-1);return"/"===n?t:("#"===n?t=t.slice(0,-1):-1!==t.indexOf("?")||/\.(?:js)$/.test(t)||(t+=".js"),t.indexOf(":80/")>0&&(t=t.replace(":80/","/")),t)}function y(t){var n,e,r,i,a,o={},u=nn.directorys;for(n=0;u.length>n&&!o[t];n++){i=u[n];for(a in i)if(e=i[a],r=RegExp("^"+a+"/"),r.test(t)&&!o[t]){t=t.replace(r,e),o[t]=!0;break}}return t}function m(t){var n=nn.alias;if(n){var e=n[t];return e?e:y(t)}return t}function x(t,n){n=l(n||an.basepath),nn.init&&(t=m(t));var e="";return 0===t.indexOf("./")||0===t.indexOf("../")?(0===t.indexOf("./")&&(t=t.substring(2)),e=n+t):e="/"===t.charAt(0)&&"/"!==t.charAt(1)?n+t.substring(1):n+"/"+t,g(e)}function b(t,n){return Z[t]?(n(),void 0):X[t]?(Y[t].push(n),void 0):(X[t]=!0,Y[t]=[n],O(t,function(){Z[t]=!0,delete X[t];var n=Y[t];n&&(delete Y[t],z(n,function(t){t()}))},K),void 0)}function O(t,e,r){var i=j("script",r);i.onload=i.onerror=i.onreadystatechange=function(){/loaded|complete|undefined/.test(i.readyState)&&(i.onload=i.onerror=i.onreadystatechange=null,i.parentNode&&!V&&i.parentNode.removeChild(i),i=n,o(e)&&e())},i.async="async",i.src=t,E(i)}function j(t,n){var e=C.createElement(t);return n&&(e.charset=n),e}function E(t){var n=e("base",J)[0];n?J.insertBefore(t,n):J.appendChild(t)}function w(t){if(!t||t.status!==en.save)return!1;var n=t.dependencies;if(n.length){if(q(n,rn))return!0;for(var e=0;n.length>e;e++)if(w(an.cache[n[e]]))return!0}return rn.pop(),!1}function q(t,n){var e=t.concat(n);return e.length>u(e).length}function A(t){return D(t.dependencies,function(n){return rn.push(t.id),!w(an.cache[n])})}function $(t){return a(t)&&(t=[t]),G(t,function(t){return x(t)})}function _(t,n){function e(t){(t||{}).status<en.ready&&(t.status=en.ready),--a,0===a&&n()}t=$(t);var r=D(t,function(t){return t&&(!an.cache[t]||an.cache[t].status<en.ready)}),i=r.length;if(0===i)return n(),void 0;var a=i;z(r,function(t){function n(){if(z(tn,function(n){r._save(n,t)}),tn=[],r.status>=en.save){var n=A(r);n.length?_(n,function(){e(r)}):e(r)}else e()}var r=an.get(t);r.status<en.save?b(t,n):n()})}function S(t,n){_(t,function(){t=$(t);var e=G(t,function(t){return t?an.cache[t]._compile():null});o(n)&&n.apply(null,e)})}function k(t){nn=t,nn.directorys=[];var n,e,r,i=nn.alias;if(i)for(n in i)e=i[n],p(e)&&(r={},r[n]=e,nn.directorys.push(r));nn.init=!0}function N(t){this.id=t,this.status=0,this.dependencies=[],this.exports=null,this.parent=[],this.factory=r}var B=!(typeof window===n||!t.navigator||!t.document);if(B){var C=t.document,I=Array.prototype,P=Object,T=P.prototype.toString,F=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,R=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,z=I.forEach?function(t,n){t.forEach(n)}:function(t,n){for(var e=0;t.length>e;e++)n(t[e],e,t)},D=I.filter?function(t,n){return t.filter(n)}:function(){var t=[];return z(arr,function(n,e,r){fn(n,e,r)&&t.push(n)}),t},G=I.map?function(t,n){return t.map(n)}:function(t,n){var e=[];return z(t,function(t,r,i){e.push(n(t,r,i))}),e},H=P.keys?P.keys:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n};I.indexOf?function(t,n){return t.indexOf(n)}:function(t,n){for(var e=0;t.length>e;e++)if(t[e]===n)return e;return-1},i(h.prototype,{trigger:function(t,n){var e=this.map[t];e&&z(e,function(t){t.apply(this,n)})},on:function(t,n){this.map[t]?this.map[t].push(n):this.map[t]=[n]}});var J=C.head||e("head")[0]||C.documentElement,K="utf-8",L=e("script"),M=L[L.length-1],Q=c(M,"data-path")||M.src||c(M,"src"),U=c(M,"data-config"),V="true"===c(M,"data-debug"),W=c(M,"data-main"),X={},Y={},Z={},tn=[],nn={},en={created:0,save:1,ready:2,compiling:3,compiled:4},rn=[];i(N.prototype,{_compile:function(){function t(t){t=x(t);var e=an.cache[t];return e?e.status===en.compiling?e.exports:(e.parent=n,e._compile()):null}var n=this;if(n.status===en.compiled)return n.exports;if(n.status<en.save)return null;n.status=en.compiling,t.cache=an.cache,n.require=t,n.exports={};var e=n.factory;return o(e)&&f(e,n),n.status=en.compiled,n.exports},_save:function(t,n){this.status<en.save&&(this.id=x(t.id,n),this.dependencies=t.deps,this.factory=t.factory,this.status=en.save)}});var an=i({basepath:Q,config:U,cache:{},get:function(t){return an.cache[t]||(an.cache[t]=new N(t))},define:function(t,n){var e=s(""+n),r={id:t,deps:e,factory:n};tn.push(r)},use:function(t,n){nn.init?S(t,n):S(U,function(e){k(e),S(t,n)})}});t.lithe=an,t.define=an.define,W&&t.lithe.use(W)}else exports.tool=require("./lib/lithe-tool.js"),exports.hfs=require("./lib/lithe-hfs.js")})(this);