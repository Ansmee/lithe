/* 
 lithe 
 @author xiaojue [designsor@gmail.com] 
 @fileoverview a javascript common loader 
 @vserion 0.2.5 
 */
!function(a,b){function c(a,b){return b=b||J,b?b.getElementsByTagName(a):b}function d(){}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function f(a){return"[object String]"===M.call(a)}function g(a){return"[object Function]"===M.call(a)}function h(a){var b={};return P(a,function(a){b[a]=1}),S(b)}function i(a,b){return a.getAttribute(b)}function j(a){var b=[];return a.replace(N,"").replace(O,function(a,c){b.push(c)}),h(b)}function k(a,c){var d;try{d=a(c.require,c.exports,c)}catch(e){throw new Error(c.id+":"+e)}d!==b&&(c.exports=d)}function l(){this.map={}}function m(a){return a.indexOf("://")>0||0===a.indexOf("//")}function n(a){return!p(a)}function o(a){var b=a.match(/[^?]*(?=\/.*$)/);return(b?b[0]:".")+"/"}function p(a){return a.slice(a.lastIndexOf("/")+1).replace(/\?.*$/,"")}function q(a){var b=/([^:\/])\/\/+/g;if(b.lastIndex=0,b.test(a)&&(a=a.replace(b,"$1/")),-1===a.indexOf("."))return a;for(var c,d=a.split("/"),e=[],f=0;f<d.length;f++)if(c=d[f],".."===c){if(0===e.length)throw new Error("The path is invalid: "+a);e.pop()}else"."!==c&&e.push(c);return e.join("/")}function r(a,b){a=q(a);var c=a.charAt(a.length-1);return"/"===c?a:("#"===c?a=a.slice(0,-1):-1!==a.indexOf("?")||/\.(?:js)$/.test(a)||(a+=".js"),a.indexOf(":80/")>0&&(a=a.replace(":80/","/")),b&&(a=a.replace(/\?.+$/,"")),a)}function s(a){var b,c,d,e,f,g={},h=db.directorys;for(b=0;b<h.length&&!g[a];b++){e=h[b];for(f in e)if(c=e[f],d=new RegExp("^"+f+"/"),d.test(a)&&!g[a]){a=a.replace(d,c),g[a]=!0;break}}return a}function t(a){var b=db.alias;if(b){var c=b[a];return c?c:s(a)}return a}function u(a,b){if(b=o(b||gb.basepath),m(a))return a;db.init&&(a=t(a));var c="";return 0===a.indexOf("./")||0===a.indexOf("../")?(0===a.indexOf("./")&&(a=a.substring(2)),c=b+a):c="/"===a.charAt(0)&&"/"!==a.charAt(1)?b+a.substring(1):b+"/"+a,r(c)}function v(a,b){return bb[a]?(b(),void 0):_[a]?(ab[a].push(b),void 0):(_[a]=!0,ab[a]=[b],w(a,function(){bb[a]=!0,delete _[a];var b=ab[a];b&&(delete ab[a],P(b,function(a){a()}))},U),void 0)}function w(a,c,d){var e=x("script",d);e.onload=e.onerror=e.onreadystatechange=function(){/loaded|complete|undefined/.test(e.readyState)&&(e.onload=e.onerror=e.onreadystatechange=null,e.parentNode&&!Z&&e.parentNode.removeChild(e),e=b,g(c)&&c())},e.async="async",e.src=a,y(e)}function x(a,b){var c=J.createElement(a);return b&&(c.charset=b),c}function y(a){var b=c("base",T)[0];b?T.insertBefore(a,b):T.appendChild(a)}function z(a){var b=a.id,c=Q(a.dependencies,function(a){fb.push(b);var c=A(gb.cache[u(a)]);return c&&fb.push(b),fb.pop(),!c});return C(c)}function A(a){if(!a||a.status!==eb.save)return!1;fb.push(a.id);var b=a.dependencies;if(b.length){if(B(b,fb))return!0;for(var c=0;c<b.length;c++)if(A(gb.cache[u(b[c])]))return!0}return fb.pop(),!1}function B(a,b){var c=a.concat(b);return c.length>h(c).length}function C(a){return f(a)&&(a=[a]),R(a,function(a){return u(a)})}function D(a,b){function c(a){(a||{}).status<eb.ready&&(a.status=eb.ready),--f,0===f&&b()}a=C(a);var d=Q(a,function(a){return a&&(!gb.cache[a]||gb.cache[a].status<eb.ready)}),e=d.length;if(0===e)return b(),gb.events.trigger("end"),void 0;var f=e;P(d,function(a){function b(){if(E(),d.status>=eb.save){var a=z(d);a.length?D(a,function(){c(d)}):c(d)}else c()}var d=gb.get(a);d.status<eb.save?v(a,b):b()})}function E(){P(cb,function(a){var b=gb.get(a.id);b._save(a)}),cb=[]}function F(a,b){D(a,function(){a=C(a);var c=R(a,function(a){return a?gb.get(a)._compile():null});g(b)&&b.apply(null,c)})}function G(a){db=a,db.directorys=[];var b,c,d,e=db.alias;if(e)for(b in e)c=e[b],n(c)&&(d={},d[b]=c,db.directorys.push(d));db.init=!0,db.basepath&&(gb.basepath=db.basepath),gb.config=db}function H(a){this.id=a,this.status=0,this.dependencies=[],this.exports=null,this.parent=[],this.factory=d}var I=!(typeof window===b||!a.navigator||!a.document);if(I){{var J=a.document,K=Array.prototype,L=Object,M=L.prototype.toString,N=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,O=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,P=K.forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0;c<a.length;c++)b(a[c],c,a)},Q=K.filter?function(a,b){return a.filter(b)}:function(a,b){var c=[];return P(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c},R=K.map?function(a,b){return a.map(b)}:function(a,b){var c=[];return P(a,function(a,d,e){c.push(b(a,d,e))}),c},S=L.keys?L.keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};K.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}}e(l.prototype,{trigger:function(a,b){var c=this.map[a];c&&P(c,function(a){a.apply(this,b)})},on:function(a,b){this.map[a]?this.map[a].push(b):this.map[a]=[b]}});var T=J.head||c("head")[0]||J.documentElement,U="utf-8",V=c("script"),W=V[V.length-1],X=i(W,"data-path")||W.src||i(W,"src"),Y=i(W,"data-config"),Z="true"===i(W,"data-debug"),$=i(W,"data-main"),_={},ab={},bb={},cb=[],db={},eb={created:0,save:1,ready:2,compiling:3,compiled:4},fb=[];Y&&(Y=C(Y)),e(H.prototype,{_compile:function(){function a(a){a=r(u(a),!0);var c=gb.cache[a];return c?c.status===eb.compiling?c.exports:(c.parent=b,c._compile()):null}var b=this;if(b.status===eb.compiled)return b.exports;if(b.status<eb.save)return null;b.status=eb.compiling,a.cache=gb.cache,b.require=a,b.exports={};var c=b.factory;return g(c)&&k(c,b),b.status=eb.compiled,gb.events.trigger("compiled",[b]),b.exports},_save:function(a){this.status<eb.save&&(this.id=a.id,this.name=a.name,this.dependencies=a.deps,this.factory=a.factory,this.status=eb.save)}});var gb=e({basepath:X,events:new l,cache:{},get:function(a){return a=r(a,!0),gb.cache[a]||(gb.cache[a]=new H(a))},define:function(a,b){var c=j(b.toString()),d={id:u(a),name:a,deps:c,factory:b};cb.push(d)},use:function(a,b){!Y||db.init?F(a,b):function(){E(),F(Y,function(c){G(c),F(a,b)})}()}});a.lithe=gb,a.define=gb.define,$&&setTimeout(function(){a.lithe.use($)})}else exports.tool=require("./lib/lithe-tool.js"),exports.hfs=require("./lib/lithe-hfs.js")}(this);